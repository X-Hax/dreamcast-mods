Name=Music Restores
Author=Woofmute
Version=0.46
Description=Makes stages without music call BGMTask and play music.\nModified AFS banks for this mod can be found at: https://dcmods.unreliable.network/owncloud/data/PiKeyAr/files/SA1%20research/autodemo/files/SAAD_MusicRestoresAFS.7z \n\nImplements a second music afs bank, BG2.AFS, as a workaround for not being able to play ids higher than 0x23 in BGM.AFS.\n\nDisables event playback in all hubs. Restores controls in hubs and camera in Sky Chase.\n\nMiniCart is not going to have its music restored due to being in a very early state with no good location to patch.
GameVersions=610-7029  V1.00019981016

[1ST_READ.BIN]
;BG2.AFS

;BGMTask hijack
ce1c6=2fa024e7
;BGMBG2AFS check ADX id initialised
ce228=49d5526011400189
;BGMAFS
ce230=cbaf0cd5
;check which bank we need
ce234=7330fb8bdc700225c5af15d5

;pointer to bg2.afs string
ce294,be=8c0de32a
;bg2.afs string
ce32a,strnull=bg2.afs


[STG01.PRS]
;Emerald Coast

;Act1 Init changes
380=61d40b440900
;Act2 Init Changes
40e=3fd40b440900
;Act1 call CreateSomeTask BGMTask SendBGMID rts
195fa8=224f11d301e511d60b4300e4021e10d20b4204e40bd3139bb365264f0b00b366
;Act2 call CreateSomeTask BGMTask SendBGMID rts
195fc8=224f09d301e509d60b4300e4021e08d20b4205e403d2039bb365264f0b00b366

;pointer to Act1BGM code
508,be=0ca95fa8
;pointer to Act2BGM code
50c,be=0ca95fc8
;word for r11
195fe8,be=3946
;pointer for Act1+2 thing
195fec,be=8c6023ba
;pointer for CreateSomeTask
195ff0,be=8c078f40
;pointer for BGMTask
195ff4,be=8c0de1a0
;pointer for SendBGMID
195ff8,be=8c0de3dc


[STG02.PRS]
;Windy Valley

;ActInit hijack
7d52=56d00b405c64
;BGM code
1d4b44=224f462f0dd301e50dd60b4300e4021e0cd2f6600188068902880989
;Act1 BGM code
1d4b60=0b421de4264f0b0000e0
;Act2 BGM code
1d4b6a=0b421ee4264f0b0001e0
;Act3 BGM code
1d4b74=0b421fe4264f0b0002e00900

;pointer for STG02BGM code
7eac,be=0cad4b44
;pointer for CreateSomeTask
1d4b80,be=8c078f40
;pointer for BGMTask
1d4b84,be=8c0de1a0
;pointer for SendBGMID
1d4b88,be=8c0de3dc


[STG03.PRS]
;Twinkle Park

;Act1 loop hijack branch
53c4=33a00900
;Act2 loop hijack branch
53c8=efa00900
;Act2b loop hijack branch
53cc=50a10900
;Act3 loop hijack branch
53d0=b8a10900
;Act1 Initial Init hijack branch
53ec=0d89
;Act2 Initial Init hijack branch
53f0=1089
;Act3 Initial Init hijack branch
53f4=1689
;Act1 Initial Init BGM
540a=6cd00b400900f4af0900
;Act2 Initial Init BGM
5414=69d00b400900f1af0900
;Act3 Initial Init BGM
5424=65d00b40090009a00900
;Act1 loop hijack code
542e=224f02d00b40462ff66407a0264f
;Act2 loop hijack code
55aa=224f02d00b40462ff66478af264f
;Act2b loop hijack code
5670=224f29d00b40462ff6643aaf264f
;Act3 loop hijack code
5744=224f03d00b40462ff664ffae264f
;BGMTPAct1
0ca900=224f25d442600188098901e0022419d301e519d60b4302e418d20b4220e4264f0b000900
;BGMTPAct2
0ca924=224f1dd442600188098901e0022410d301e510d60b4302e40fd20b4221e400e016d2264f0b000222
;BGMTPAct3
0ca94c=224f14d442600188098901e0022406d301e506d60b4302e405d20b4222e400e00bd2264f0b000222
;BGMInit
0ca980=224f00e004d2022204d2022204d20222264f0b000900

;pointer for initBGM
55bc,be=0c9ca980
;pointer for BGMTPAct1
543c,be=0c9ca900
;pointer for BGMTPAct2
55b8,be=0c9ca924
;pointer for BGMTPAct2b
5718,be=0c9ca924
;pointer for BGMTPAct3
5754,be=0c9ca94c
;pointer for CreateSomeTask
0ca974,be=8c078f40
;pointer for BGMTask
0ca978,be=8c0de1a0
;pointer for SendBGMID
0ca97c,be=8c0de3dc
;pointer for DoneAct1
0ca998,be=0c9ca9a4
;pointer for DoneAct2
0ca99c,be=0c9ca9a8
;pointer for DoneAct3
0ca9a0,be=0c9ca9ac


[STG06.PRS]
;Lost World

;AllActInit changes
18=16d40b4409000900
;STG06BGM code
1aa70c=224f0ad301e50ad60b4300e4021e09d2e2600d8804890b4223e4264f0b0009000b4224e4264f0b0009000009

;pointer to STG06BGM code
74,be=0caaa70c
;pointer for CreateSomeTask
1aa738,be=8c078f40
;pointer for BGMTask
1aa73c,be=8c0de1a0
;pointer for SendBGMID
1aa740,be=8c0de3dc


[STG07.PRS]
;Sky Deck

;Act 1 Init changes
9296=45d40b440900
;Act 2 Init changes
9312=27d40b440900
;Act 3 Init changes
9522=20d40b440900
;Act1BGM code
160000=224f16d301e516d60b4300e4021e15d20b4212e414c715d4264f0b0008f6
;Act2BGM code
16001e=224f0ed301e50ed60b4300e4021e0dd20b4213e40fc70dd4264f0b0008f6
;Act3BGM code
16003c=224f07d301e507d60b4300e4021e06d20b4214e408c706d4264f0b0008f60900

;pointer to Act1BGM
93ac,be=0ca60000
;pointer to Act2BGM
93b0,be=0ca6001e
;pointer to Act3BGM
95a4,be=0ca6003c
;pointer for CreateSomeTask
16005c,be=8c078f40
;pointer for BGMTask
160060,be=8c0de1a0
;pointer for SendBGMID
160064,be=8c0de3dc
;pointer for all act thing
16006c,be=8c7689e0

;float for Act1
160068,f32=0.049999997
;float for Act2
160070,f32=0.25
;float for Act3
160074,f32=0.25


[STG09.PRS]
;Casinopolis

;ActInit Branches
90=00881a89018818890288168903881489
;ActInit Hijack
ca=d62f27dd0b4de62ff66e02880f8903880f890aa00900
;Hijack Returns
f4=d6aff66dd6aff66ddeaff66d
;BGMCZ code
076400=224f062f0ed301e50ed60b4302e40ed2f6600188088902880a8903880c890b4225e4264f0b0009000b4226e4f9af09000b4227e4f5af09000b4228e4f1af0900

;pointer for BGMCZ
16c,be=0c976400
;pointer for CreateSomeTask
076440,be=8c078f40
;pointer for BGMTask
076444,be=8c0de1a0
;pointer for SendBGMID
076448,be=8c0de3dc


[STG10.PRS]
;Final Egg

;new return branch change
18=4ea00900
;ActInit and Return changes
40=188902881d892ca00900
70=12a00900
;Act2 Init changes
74=1cd30b4309000b4bc02e13a00900
;Act3 Init changes
82=1ad30b43090014d203e514d60b4202e40b4b0900c02e
;Act1 Init end reposition
98=12d30b430ae403a00900
;Act4 Init changes
a2=13d30b430900
;returns reposition
a8=0b4d0900264ff66bf66cf66d0b00f66e0b00090000090009

;Act2 BGM code
232d00=224f13d301e513d60b4300e4021e12d20b420be4264f0b000900
;Act3 BGM code
232d1a=224f0cd301e50cd60b4300e4021e0bd20b420ae4264f0b000900
;Act4 BGM code
232d34=224f06d301e506d60b4300e4021e05d20b420be4264f0b00c02e0000

;pointer to Act2BGM
e8,be=0cb32d00
;pointer to Act3BGM
ec,be=0cb32d1a
;pointer to Act4BGM
f0,be=0cb32d34
;pointer for CreateSomeTask
232d50,be=8c078f40
;pointer for BGMTask
232d54,be=8c0de1a0
;pointer for SendBGMID
232d58,be=8c0de3dc


[B_CHAOS2.PRS]
;Chaos 2

;Chaos 2 Init hijack
2ab0=1ad32b43090009000900
;BGMC2 code
076920=224f08d301e508d60b4303e405d301e506d60b4302e406d20b422ae4264f0b0009000900

;pointer for BGMC2
2b1c,be=0c976920
;pointer for CreateElementalTask
076944,be=8c078f40
;pointer for ObjChaos2
076948,be=0c902b60
;pointer for BGMTask
07694c,be=8c0de1a0
;pointer for SendBGMID
076950,be=8c0de3dc


[ADV00OBJ.PRS]
;Station Square

;branch1
ce=5189
;SS EventInit replace with BGMSS
dc=1cd301e51ad60b4302e41dd20b4218e414d40b44090009000900090009000900090009000900090009000900090009000900090009000900090009000900090009000900090009000900090009000900090009000900

;pointer for enable controls
140,be=8c045060
;pointer for SendBGMID
15c,be=8c0de3dc


;BGMSS(ALT with event init intact DO NOT COMBINE)
;SS EventInit hijack
;b4=29de0b4e090009005aa00900
;branch1
;d2=ef89
;branch2
;d6=ed89
;branch3
;d8=ecaf
;branch4
;f4=de8b
;branch5
;116=cd8b
;branch6
;162=a7af
;branch7
;16e=a18b

;BGMSS code
;d4b0=224f0dd10b41090008200e8b09dee26000880a8b01e0022e08d301e508d60b4302e4090007d20b4218e4264f0b000900

;init patch mode
;d4e0=00000000

;pointer for BGMSS
;15c,be=0ca8d4b0
;pointer for patch mode
;d4e4,be=0ca8d4e0
;pointer for cutscene ptr check
;d4e8,be=8c040926
;pointer for createsometask
;d4ec,be=8c078f40
;pointer for bgm task
;d4f0,be=8c0de1a0
;pointer for send bgm id
;d4f4,be=8c0de3dc


[ADV0100.PRS]
;Egg Carrier Exterior

;nop check for Sonic
8824=09000900
;nop return if not Sonic
882a=09000900
;branch1
8836=5389
;branch2
883a=5189
;replace EventInit with BGMEC
8840=1cd301e51ad60b4302e41fd20b4231e41ed40b44090009000900090009000900090009000900090009000900
;pointer for SendBGMID
88c8,be=8c0de3dc
;pointer for enable controls
88cc,be=8c045060


[ADV0130.PRS]
;Egg Carrier Interior
;branch1
0e=6189
;BGMEC2 code
1c=27d301e525d60b4302e42fd20b4231e42ed40b4409000900090009000900090009000900090009000900090009000900090009000900090009000900090009000900090009000900090009000900090009000900090009000900090009000900090009000900090009000900090009000900090009000900090009000900090011a001e2

;pointer for SendBGMID
e4,be=8c0de3dc
;pointer for enable controls
e8,be=8c045060


[ADV02OBJ.PRS]
;Mystic Ruins

;branch1
40=4489
;branch2
44=4289
;branch3
48=4589
;branch4
4c=3e89
;ActInit Hijack ABD
cc=0bd80b480900c6af0900
;ActInit Hijack C
d6=09d80b480900b9af0900
;BGMMR code
35400=224f03880c890dd301e50dd60b4302e40cd20b4232e40cd40b4409000ba00900
;BGMMR Act4 code
35420=06d301e506d60b4302e406d20b420ae405d40b440900
;BGMMR Return code
35436=264f0b000900

;pointer for BGMMR
fc,be=0cab5400
;pointer for CreateSomeTask
3543c,be=8c078f40
;pointer for BGM Task
35440,be=8c0de1a0
;pointer for SendBGMID
35444,be=8c0de3dc
;pointer for enable controls
35448,be=8c045060


[SHOOTING.PRS]
;Sky Chase

;branch1
25c=0389
;branch2
260=0689
;ActInit Hijack Act1
266=05d20b42090038a00900
;ActInit Hijack Act2
270=02d20b42090049a00900
;BGMSC code
1a9200=e62fd62fc62fb62fa62f224f09d200e50b421fe408d301e508d60b4302e408d20b4234e4264ff66af66bf66cf66d0b00f66e0900

;pointer for BGMSC
27c,be=0caa9200
;pointer for CameraSetEventCamera
1a9234,be=8c019280
;pointer for CreateSomeTask
1a9238,be=8c078f40
;pointer for BGM Task
1a923c,be=8c0de1a0
;pointer for SendBGMID
1a9240,be=8c0de3dc